<Project>
  <PropertyGroup>
    <TargetFramework Condition="'$(TargetFramework)'==''">net8.0</TargetFramework>
    <IsPackable>true</IsPackable>
    <IncludeBuildOutput>false</IncludeBuildOutput>
    <PackageId Condition="'$(PackageId)'==''">VelloSharp.Native</PackageId>
    <Title Condition="'$(Title)'==''">$(PackageId)</Title>
    <Description Condition="'$(Description)'==''">Native Vello runtime for $(NativeRid)</Description>
    <RepositoryRoot Condition="'$(RepositoryRoot)'==''">$([System.IO.Path]::GetFullPath('$(MSBuildThisFileDirectory)../..'))</RepositoryRoot>
    <PackageOutputPath Condition="'$(PackageOutputPath)'==''">$([System.IO.Path]::Combine('$(RepositoryRoot)', 'artifacts', 'nuget'))</PackageOutputPath>
    <NativeRid Condition="'$(NativeRid)'==''">unknown</NativeRid>
    <NativeAssetsDirectory Condition="'$(NativeAssetsDirectory)'==''">$(MSBuildThisFileDirectory)</NativeAssetsDirectory>
    <NativeAssetsDirectory>$([MSBuild]::EnsureTrailingSlash('$(NativeAssetsDirectory)'))</NativeAssetsDirectory>
  </PropertyGroup>

  <ItemGroup Condition="Exists('$(NativeAssetsDirectory)')">
    <NativeAsset Include="$(NativeAssetsDirectory)**/*"
                 Exclude="$(NativeAssetsDirectory)**/" />
    <None Include="@(NativeAsset)"
          Pack="true"
          PackagePath="runtimes/$(NativeRid)/native/%(RecursiveDir)%(Filename)%(Extension)"
          Visible="false" />
  </ItemGroup>

  <Target Name="ValidateNativeAssets" BeforeTargets="Pack">
    <Error Condition="'$(NativeRid)' == 'unknown'" Text="NativeRid must be provided." />
    <Error Condition="!Exists('$(NativeAssetsDirectory)')" Text="Native assets not found at '$(NativeAssetsDirectory)'." />
  </Target>
</Project>
